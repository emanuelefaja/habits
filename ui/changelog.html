<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
{{ template "head" . }}
<body class="h-full">
    {{ template "header" dict "User" .User "Page" "changelog" }}

    <div x-data="changelog()" class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-12">
            <h1 class="text-3xl font-bold tracking-tight text-gray-900 mb-2 sm:mb-0">Changelog ðŸš€</h1>
            <p class="text-lg text-gray-600">Latest updates and improvements to <b>habits</b></p>
        </div>

        <div class="flex space-x-4 mb-8">
            <button 
                @click="view = 'main'"
                :class="{'bg-[#2da44e] text-white': view === 'main', 'bg-white text-gray-700 hover:bg-gray-50': view !== 'main'}"
                class="px-4 py-2 rounded-md font-medium shadow-sm border border-gray-300 transition-colors">
                Main Changes
            </button>
            <button 
                @click="view = 'detailed'"
                :class="{'bg-[#2da44e] text-white': view === 'detailed', 'bg-white text-gray-700 hover:bg-gray-50': view !== 'detailed'}"
                class="px-4 py-2 rounded-md font-medium shadow-sm border border-gray-300 transition-colors">
                Detailed Changes
            </button>
        </div>

        <div x-show="view === 'main'" class="space-y-8 relative">
            <template x-for="item in changelogItems" :key="item.version">
                <div class="border-t border-gray-200 pt-8">
                    <div class="sticky top-0 bg-gray-50 z-10">
                        <div class="absolute inset-x-0 -top-4 h-4 bg-gradient-to-b from-gray-50 to-transparent"></div>
                        
                        <div class="flex items-center justify-between py-2">
                            <h2 class="text font-bold tracking-tight text-gray-500" x-text="item.version"></h2>
                            <span class="text-xl tracking-tight font-bold text-gray-900" x-text="item.title"></span>
                        </div>
                    </div>
                    <span class="text-sm text-gray-500 block mb-4" x-text="item.date"></span>
                    <div class="space-y-4">
                        <div>
                            <p class="text-gray-600 mb-4" x-text="item.description"></p>
                            <template x-if="item.video">
                                <video class="w-full rounded-lg shadow-lg" autoplay muted loop>
                                    <source :src="item.video" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </template>
                        </div>
                    </div>    
                </div>
            </template>
        </div>

        <div x-show="view === 'detailed'" class="space-y-8 relative">
            <div 
                x-show="connectionStatus" 
                :class="{
                    'bg-green-50 text-green-700 border-green-200': connectionStatus === 'connected',
                    'bg-red-50 text-red-700 border-red-200': connectionStatus === 'error'
                }"
                class="p-4 rounded-md border mb-4"
            >
                <div class="flex items-center">
                    <template x-if="connectionStatus === 'connected'">
                        <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </template>
                    <template x-if="connectionStatus === 'error'">
                        <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </template>
                    <span x-text="statusMessage"></span>
                </div>
            </div>

            <template x-for="commit in commitHistory" :key="commit.id">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900" x-text="commit.title"></h3>
                            <span class="text-sm text-gray-500" x-text="formatDate(commit.date)"></span>
                        </div>
                        <span class="text-xs font-mono bg-gray-100 text-gray-600 px-2 py-1 rounded" x-text="commit.id"></span>
                    </div>
                    
                    <p x-show="commit.description" class="text-gray-600 text-sm mb-4" x-text="commit.description"></p>
                    
                    <div class="text-sm">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-xs font-medium text-gray-500 uppercase mb-3">Code Changes</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Lines Added</span>
                                    <span class="font-medium text-green-600" x-text="`+${commit.additions} lines`"></span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Lines Removed</span>
                                    <span class="font-medium text-red-600" x-text="`-${commit.deletions} lines`"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('changelog', () => ({
                view: 'main',
                changelogItems: [
                {
                        version: 'v0.1.4',
                        title: 'ðŸ‘€ Detailed Changelog',
                        date: 'December 11, 2024',
                        description: 'We have added a detailed changelog page that shows all the granular commits directly from the Github repository, as well as the number of lines added and removed in each commit.',
                        video: '/static/videos/detailedchangelog.mp4'
                    },
                    {
                        version: 'v0.1.3',
                        title: 'âœï¸ Edit Habits',
                        date: 'December 11, 2024',
                        description: 'You can now edit the name of your habits, and also delete habits with a warning modal that require you to retype the habit name to confirm the deletion.',
                        video: '/static/videos/edithabits.mp4'
                    },
                    {
                        version: 'v0.1.2',
                        title: 'ðŸŽ‰ Confetti',
                        date: 'December 11, 2024',
                        description: 'We now welcome new users with a confetti animation and when setting habits to a done status on the home page, there is a small probability of a confetti animation.',
                        video: '/static/videos/confetti.mp4'
                    },
                    {
                        version: 'v0.1.1',
                        title: 'ðŸ“Š Individual Numeric Habit View',
                        date: 'December 10, 2024',
                        description: 'We have updated the individual habit view to support numeric habits. This update introduces different shades of green to represent different ranges of numeric values, and a new heatmap to visualize the habit over time.',
                        video: '/static/videos/numerichabits.mp4'
                    },
                    {
                        version: 'v0.1.0',
                        title: 'ðŸš€ Changelog',
                        date: 'December 10, 2024',
                        description: 'We implemented this beautiful and informative changelog page and added a version number to the logo on the header.',
                        video: '/static/videos/changelog.mp4'
                    },
                    {
                        version: 'v0.0.9',
                        title: 'ðŸ“Š Individual Binary Habit View',
                        date: 'December 9, 2024',
                        description: 'We now show certain key stats in the individual binary habit view, such as the number of times you have done, missed, and skipped the habit. We have also introduced a Github-style yearly heatmap for the habit.',
                        video: '/static/videos/individualbinaryview.mp4'
                    },
                    {
                        version: 'v0.0.8',
                        title: 'ðŸŽ² Generate Passwords',
                        date: 'December 9, 2024',
                        description: 'There is now a button to generate a random password for you to use in the registration form, instead of having to type one in manually. This encourages users to use stronger unique passwords.',
                        video: '/static/videos/generatepassword.mp4'
                    },
                    {
                        version: 'v0.0.7',
                        title: 'ðŸ’ª Sets & Reps Habits',
                        date: 'December 8, 2024',
                        description: 'This new habit type is suitable for tracking calisthenic exercises such as pushups, situps, squats, etc. You can log multiple sets of reps, and the habit will display the total number of reps for the day.',
                        video: '/static/videos/setrephabits.mp4'
                    },
                    {
                        version: 'v0.0.6',
                        title: 'âš™ï¸ Settings',
                        date: 'December 8, 2024',
                        description: 'A settings screen that allows users to change their name, email, password, export their data to CSV and also to delete their account.',
                        video: '/static/videos/settings.mp4'
                    },
                    {
                        version: 'v0.0.5',
                        title: 'ðŸ—³ï¸ Choice Habits',
                        date: 'December 7, 2024',
                        description: 'This new habit type allows you to choose from a set of options, and then log which option you chose. This is useful for tracking things like your mood, if you ate healthy, or if you exercised. Each day can have one choice log with an emoji for display',
                        video: '/static/videos/choicehabit.mp4'
                    },
                    {
                        version: 'v0.0.4',
                        title: 'ðŸš€ Roadmap',
                        date: 'December 6, 2024',
                        description: 'We now have a roadmap where logged-in users can vote on new features and improvements as well as submit their own ideas.',
                        video: '/static/videos/roadmap.mp4'
                    },
                    {
                        version: 'v0.0.3',
                        title: 'ðŸ”¢ Numeric Habits',
                        date: 'December 5, 2024',
                        description: 'You can now log numeric habits, and each day can have one numeric log. This is useful for tracking things like weight, number of times you meditate, number of times you exercise, etc.',
                        video: '/static/videos/v0.0.3.mp4'
                    },
                    {
                        version: 'v0.0.2',
                        title: 'ðŸ”‘ Authentication',
                        date: 'December 5, 2024',
                        description: 'You can now register via an email and password, login, and logout. All passwords are securely hashed using bcrypt before storage, and we enforce strong password requirements including minimum length, special characters, and complexity rules. Our session management is handled securely using the SCS (Session Control System) library with encrypted cookies.',
                        video: '/static/videos/v0.0.2.mp4'
                    },
                    {
                        version: 'v0.0.1',
                        title: 'âœ… Initial Release',
                        date: 'December 4, 2024',
                        description: 'This first version of habits allows you to start tracking simple binary habits in a basic monthly grid view. You can choose from some predefined habits or create your own. We support a few different statuses such as âœ… done, âŒ missed, and â­ï¸ skipped.',
                        video: '/static/videos/v0.0.1.mp4'
                    }
                ],
                commitHistory: [],
                connectionStatus: null,
                statusMessage: '',
                
                formatDate(dateString) {
                    const date = new Date(dateString);
                    const hours = date.getHours();
                    const minutes = date.getMinutes();
                    const ampm = hours >= 12 ? 'pm' : 'am';
                    const formattedHours = hours % 12 || 12;
                    const formattedMinutes = minutes.toString().padStart(2, '0');
                    const day = date.getDate();
                    const month = date.toLocaleString('default', { month: 'long' });
                    const year = date.getFullYear();
                    
                    return `${formattedHours}:${formattedMinutes}${ampm} ${day} ${month} ${year}`;
                },

                async init() {
                    await this.fetchCommits();
                },

                async fetchCommits() {
                    try {
                        const response = await fetch('/api/commits');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        this.commitHistory = await response.json();
                        this.connectionStatus = 'connected';
                        this.statusMessage = `Successfully loaded ${this.commitHistory.length} changes`;
                    } catch (error) {
                        console.error('Error fetching commits:', error);
                        this.connectionStatus = 'error';
                        this.statusMessage = `Error loading changes: ${error.message}`;
                    }
                }
            }));
        });
    </script>
</body>
</html>
