{{ define "yearly-grid" }}
<div x-data="yearlyGrid" class="flex justify-center mt-8">
    <div class="bg-white p-8 shadow sm:rounded-lg w-full">
        <div class="overflow-auto">
            <div class="flex flex-col">
                <!-- Month labels row -->
                <div class="flex items-center mb-2">
                    <div style="width: 30px;"></div>
                    <div class="flex" style="width: calc(100% - 30px);">
                        <template x-for="(month, mIndex) in monthNames" :key="'month-'+mIndex">
                            <div x-show="getMonthStartWeek(mIndex) !== -1"
                                 :style="{ 
                                     width: getMonthWidth(mIndex),
                                     marginLeft: mIndex === 0 ? '0' : '',
                                     borderLeft: mIndex !== 0 ? '1px solid #eee' : ''
                                 }"
                                 class="text-center text-xs font-semibold"
                                 x-text="month">
                            </div>
                        </template>
                    </div>
                </div>
    
                <!-- Days + Grid -->
                <div class="flex">
                    <!-- Day Labels -->
                    <div class="flex flex-col justify-center">
                        <template x-for="(dayLabel, index) in ['M', 'T', 'W', 'T', 'F', 'S', 'S']" :key="index">
                            <div class="flex items-center justify-center text-sm font-medium text-gray-300"
                                 style="height: 17px; margin-bottom: 3px; width: 30px; margin-right: 8px; line-height: 15px;">
                                <span x-text="dayLabel"></span>
                            </div>
                        </template>
                    </div>
    
                    <!-- Year Heatmap Grid -->
                    <div class="flex">
                        <template x-for="(week, wIndex) in weeks" :key="'week-'+wIndex">
                            <div class="flex flex-col mr-1">
                                <template x-for="(day, dIndex) in week" :key="'day-'+wIndex+'-'+dIndex">
                                    <div :class="{
                                            'bg-gray-300': day !== null,
                                            'bg-transparent': day === null
                                         }"
                                         style="width: 17px; height: 17px; margin-bottom: 3px; border-radius: 2px;">
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('alpine:init', () => {
    Alpine.data('yearlyGrid', () => ({
        dayLabels: ['M', 'T', 'W', 'T', 'F', 'S', 'S'],
        monthNames: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        weeks: [],
        monthDays: [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], // Days in each month for 2024

        init() {
            // Generate all days of 2024 in a 2D array by weeks (Monday to Sunday).
            // 2024-01-01 is a Monday.
            const startDate = new Date(2024, 0, 1);
            const endDate = new Date(2025, 0, 1);

            // We'll loop through each week until we hit the endDate
            let currentDate = new Date(startDate.getTime());
            let allWeeks = [];

            while (currentDate < endDate) {
                let weekDays = [];
                for (let i = 0; i < 7; i++) {
                    if (currentDate < endDate) {
                        // If within 2024
                        if (currentDate.getFullYear() === 2024) {
                            weekDays.push(new Date(currentDate));
                        } else {
                            weekDays.push(null);
                        }
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else {
                        weekDays.push(null);
                    }
                }
                allWeeks.push(weekDays);
            }

            this.weeks = allWeeks;
        },

        getMonthStartWeek(monthIndex) {
            // Find the first week that contains a day from this month
            return this.weeks.findIndex(week => 
                week.some(day => day && day.getMonth() === monthIndex)
            );
        },

        getMonthWidth(monthIndex) {
            // Divide the grid equally among the 12 months. This should NOT be the final implementation, there must be a better way to do this!
            return '8.2%'; // 100% / 12 months
        }
    }));
});
</script>
{{ end }}