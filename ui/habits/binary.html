{{ define "binary-habit" }}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Stats Card -->
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-4 mb-8">
        <!-- Total Done Card -->
        <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">‚úÖ</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-semibold text-gray-900 truncate">Total Done</dt>
                            <dd class="text-3xl font-semibold text-gray-900" x-text="Object.values(habitLogs).filter(log => log.status === 'done').length"></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <!-- Missed Card -->
        <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">‚ùå</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-semibold text-gray-900 truncate">Missed</dt>
                            <dd class="text-3xl font-semibold text-gray-900" x-text="Object.values(habitLogs).filter(log => log.status === 'missed').length"></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <!-- Skipped Card -->
        <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">‚è≠Ô∏è</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-semibold text-gray-900 truncate">Skipped</dt>
                            <dd class="text-3xl font-semibold text-gray-900" x-text="Object.values(habitLogs).filter(log => log.status === 'skipped').length"></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        <!-- Total Days Card -->
        <div class="bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">üìÖ</span>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-semibold text-gray-900 truncate">Total Days</dt>
                            <dd class="text-3xl font-semibold text-gray-900" x-text="Object.keys(habitLogs).length"></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Yearly Grid -->
    <div x-data="yearlyGrid" class="flex justify-center mt-8">
        <div class="bg-white p-8 shadow sm:rounded-lg w-full">
            <div class="overflow-auto">
                <div class="flex flex-col">
                    <!-- Month labels row -->
                    <div class="flex items-center mb-2">
                        <div style="width: 30px;"></div>
                        <template x-for="(week, wIndex) in weeks" :key="'month-'+wIndex">
                            <div class="flex-1 text-center text-xs font-semibold"
                                 style="width: 15px; margin-right: 3px;"
                                 x-text="getMonthLabel(wIndex)">
                            </div>
                        </template>
                    </div>
        
                    <!-- Days + Grid -->
                    <div class="flex">
                        <!-- Day Labels -->
                        <div class="flex flex-col justify-center">
                            <template x-for="(dayLabel, index) in ['M', 'T', 'W', 'T', 'F', 'S', 'S']" :key="index">
                                <div class="flex items-center justify-center text-sm font-medium text-gray-700"
                                     style="height: 15px; margin-bottom: 3px; width: 30px; margin-right: 8px; line-height: 15px;">
                                    <span x-text="dayLabel"></span>
                                </div>
                            </template>
                        </div>
        
                        <!-- Year Heatmap Grid -->
                        <div class="flex">
                            <template x-for="(week, wIndex) in weeks" :key="'week-'+wIndex">
                                <div class="flex flex-col mr-1">
                                    <template x-for="(day, dIndex) in week" :key="'day-'+wIndex+'-'+dIndex">
                                        <div :class="{
                                                'bg-gray-300': day !== null,
                                                'bg-transparent': day === null
                                             }"
                                             style="width: 15px; height: 15px; margin-bottom: 3px; border-radius: 2px;">
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('yearlyGrid', () => ({
            dayLabels: ['M', 'T', 'W', 'T', 'F', 'S', 'S'],
            monthNames: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            weeks: [],
    
            init() {
                // Generate all days of 2024 in a 2D array by weeks (Monday to Sunday).
                // 2024-01-01 is a Monday.
                const startDate = new Date(2024, 0, 1);
                const endDate = new Date(2025, 0, 1);
    
                // We'll loop through each week until we hit the endDate
                let currentDate = new Date(startDate.getTime());
                let allWeeks = [];
    
                while (currentDate < endDate) {
                    let weekDays = [];
                    for (let i = 0; i < 7; i++) {
                        if (currentDate < endDate) {
                            // If within 2024
                            if (currentDate.getFullYear() === 2024) {
                                weekDays.push(new Date(currentDate));
                            } else {
                                weekDays.push(null);
                            }
                            currentDate.setDate(currentDate.getDate() + 1);
                        } else {
                            weekDays.push(null);
                        }
                    }
                    allWeeks.push(weekDays);
                }
    
                this.weeks = allWeeks;
            },
    
            getMonthLabel(weekIndex) {
                // Get the first valid day of this week (might be null if outside 2024)
                const firstDay = this.weeks[weekIndex].find(d => d !== null);
                if (!firstDay) return '';
    
                const currentMonth = firstDay.getMonth();
                
                // Check previous week's first valid day to see if month changed
                if (weekIndex === 0) {
                    // First week: always show month if we have a valid day
                    return this.monthNames[currentMonth];
                } else {
                    const prevWeekFirstDay = this.weeks[weekIndex - 1].find(d => d !== null);
                    if (!prevWeekFirstDay || prevWeekFirstDay.getMonth() !== currentMonth) {
                        return this.monthNames[currentMonth];
                    }
                }
    
                return '';
            }
        }));
    });
    </script>
</div>

{{ end }}